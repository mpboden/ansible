---
- name: "Bash | Check if first run"
  stat:
    path: "{{ first_run }}"
  register: first_run

- name: "Bash | Create backup directory"
  ansible.builtin.file:
   path: "{{ backup_dir }}"
   state: directory
   mode: '0755'
  when: first_run.stat.islnk is not defined 

#- name: "Bash | Copy old dotfiles to backup directory"
#  ansible.builtin.copy:
#    src: "{{ ansible_user_dir }}/{{ item }}"
#    dest: "{{ backup_dir }}"
#    remote_src: yes
#  with_items: "{{ old_dotfiles }}"
#  when: first_run.stat.islnk is not defined 
#  # todo: add conditional to check if file exists before copying

- name: "Checking if config files exists"
  ansible.builtin.stat:
    path: "{{ ansible_user_dir }}/{{ item }}"
  with_items: "{{ old_dotfiles }}"
  register: stat_result

- name: Ansible
  debug:
    msg: "{{ stat_result }}"

- name: Backup Files
  ansible.builtin.copy:
    src: "{{ ansible_user_dir }}/{{ item }}"
    dest: "{{ ansible_user_dir }}/{{ backup_dir }}"
  with_items: "{{ old_dotfiles }}"
  when: stat_result.stat.exists == true
  #  when: stat_result == "True"

#- name: "Bash | Create symlinks"
#  ansible.builtin.file:
#    src: "{{ item }}"
#    dest: "{{ ansible_user_dir }}/.{{ item | basename }}"
#    state: link
#    force: true
#  with_fileglob: "files/*"
